doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title SF-Eagle (rogue)
    // Google only recognizes 'visible' microdata. This is a work-a-round.
    style(type="text/css")
      |body > div:first-of-type { width: 1px; height: 1px; overflow: hidden;}
      |body {color: aliceblue}
      |#container { height: 100vh}
      |#header { height: 10%;}
      |#header h1 { margin: 0;}
      |#header p { margin: 0;}
      |.page-title {}
      |.dayLabel {font-size: xx-large; font-variant: small-caps; font-family: "Impact", "Futura-CondensedExtraBold", sans-serif; color: aliceblue;}
      |.events-today { max-width: 400px;}
      |.event-time { display: inline-block; width: 20%; margin-bottom: 10px; color: #999; font-size: smaller; vertical-align: top; }
      |.event-title { display: inline-block; width: 75%; margin-bottom: 10px; color: #c00; font-family: sans-serif; font-variant: small-caps;}

  body
    div(itemscope itemtype="http://schema.org/Organization")
      span(itemprop="name") myGoogleListedName
      div(itemprop="address" itemscope itemtype="http://schema.org/PostalAddress")
        span(itemprop="streetAddress") myStreetAddress
        span(itemprop="addressLocality") myCity
        span(itemprop="addressRegion") myState
      img(itemprop="logo" src="myLogoUrl")
      a(href="myBusinessUrl" itemprop="url") myBusinessUrl

    #container
      #header
      #main
      #footer

    script
      :coffeescript
        if localStorage.getItem('events')
          console.log('yes localStorage')
          events = JSON.parse localStorage.getItem('events')

          today = new Date()
          now = today.getTime()
          anHour = 60*60*1000
          weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday','Saturday']
          #//- now = Math.round(new Date().getTime()/1000.0)

          closingAdjustment = if today.getHours() < 2 then 0 else 24
          closingTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 2+closingAdjustment)
          closingTimeYesterday = new Date(today.getFullYear(), today.getMonth(), today.getDate()-1, 2+closingAdjustment)

          console.log 'closingAdjustment: ', closingAdjustment
          console.log 'closingTime: ', closingTime
          console.log 'closingTimeYesterday: ', closingTimeYesterday
          todaysEvents = events.filter (event)->
            return closingTimeYesterday.getTime()/1000 < parseInt(event.date_num) < closingTime.getTime()/1000

          divToday = document.createElement('div')
          divToday.classList.add 'todays-events'
          divToday.innerHTML = '<div class="dayLabel">' + weekdays[closingTime.getDay()-1] + '</div><hr>'
          for event in todaysEvents
            end = if event.endtime == '2:00am' then '' else '-' + event.endtime
            div = document.createElement('div')
            div.classList.add 'events-today'
            div.innerHTML = (event.title).replace(/<br\ ?\/?>/g, ' ').toLowerCase()
            div.innerHTML = '<div class="event-time">' + event.time + end + '</div>' +
              ' <div class="event-title">' + div.textContent + '</div>'
            divToday.innerHTML += div.innerHTML
          footer = document.getElementById('footer')
          footerParent = footer.parentNode
          footerParent.insertBefore(divToday, footer)
        else
          console.log('no localStorage')
          console.log(localStorage.getItem('events'))


  script(src='bundle.js' async defer)
